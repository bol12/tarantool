test_run = require('test_run').new()
---
...
engine = test_run:get_cfg('engine')
---
...
box.sql.execute('pragma sql_default_engine=\''..engine..'\'')
---
- rowcount: 0
...
-- Initializing some things.
box.sql.execute("CREATE TABLE t1(id INT PRIMARY KEY, a INT);")
---
- rowcount: 1
...
box.sql.execute("CREATE TABLE t2(id INT PRIMARY KEY, a INT);")
---
- rowcount: 1
...
box.sql.execute("CREATE INDEX i1 ON t1(a);")
---
- rowcount: 1
...
box.sql.execute("CREATE INDEX i1 ON t2(a);")
---
- rowcount: 1
...
box.sql.execute("INSERT INTO t1 VALUES(1, 2);")
---
- rowcount: 1
...
box.sql.execute("INSERT INTO t2 VALUES(1, 2);")
---
- rowcount: 1
...
-- Analyze.
box.sql.execute("ANALYZE;")
---
- rowcount: 0
...
-- Checking the data.
box.sql.execute("SELECT * FROM \"_sql_stat4\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: neq
    type: UNKNOWN
  - name: nlt
    type: UNKNOWN
  - name: ndlt
    type: UNKNOWN
  - name: sample
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T1', 'T1', '1', '0', '0', !!binary kQE=]
  - ['T2', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T2', 'T2', '1', '0', '0', !!binary kQE=]
...
box.sql.execute("SELECT * FROM \"_sql_stat1\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: stat
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1 1']
  - ['T1', 'T1', '1 1']
  - ['T2', 'I1', '1 1']
  - ['T2', 'T2', '1 1']
...
-- Dropping an index.
box.sql.execute("DROP INDEX i1 ON t1;")
---
- rowcount: 3
...
-- Checking the DROP INDEX results.
box.sql.execute("SELECT * FROM \"_sql_stat4\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: neq
    type: UNKNOWN
  - name: nlt
    type: UNKNOWN
  - name: ndlt
    type: UNKNOWN
  - name: sample
    type: UNKNOWN
  rows:
  - ['T1', 'T1', '1', '0', '0', !!binary kQE=]
  - ['T2', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T2', 'T2', '1', '0', '0', !!binary kQE=]
...
box.sql.execute("SELECT * FROM \"_sql_stat1\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: stat
    type: UNKNOWN
  rows:
  - ['T1', 'T1', '1 1']
  - ['T2', 'I1', '1 1']
  - ['T2', 'T2', '1 1']
...
--Cleaning up.
box.sql.execute("DROP TABLE t1;")
---
- rowcount: 3
...
box.sql.execute("DROP TABLE t2;")
---
- rowcount: 5
...
-- Same test but dropping an INDEX ON t2.
box.sql.execute("CREATE TABLE t1(id INT PRIMARY KEY, a INT);")
---
- rowcount: 1
...
box.sql.execute("CREATE TABLE t2(id INT PRIMARY KEY, a INT);")
---
- rowcount: 1
...
box.sql.execute("CREATE INDEX i1 ON t1(a);")
---
- rowcount: 1
...
box.sql.execute("CREATE INDEX i1 ON t2(a);")
---
- rowcount: 1
...
box.sql.execute("INSERT INTO t1 VALUES(1, 2);")
---
- rowcount: 1
...
box.sql.execute("INSERT INTO t2 VALUES(1, 2);")
---
- rowcount: 1
...
-- Analyze.
box.sql.execute("ANALYZE;")
---
- rowcount: 0
...
-- Checking the data.
box.sql.execute("SELECT * FROM \"_sql_stat4\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: neq
    type: UNKNOWN
  - name: nlt
    type: UNKNOWN
  - name: ndlt
    type: UNKNOWN
  - name: sample
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T1', 'T1', '1', '0', '0', !!binary kQE=]
  - ['T2', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T2', 'T2', '1', '0', '0', !!binary kQE=]
...
box.sql.execute("SELECT * FROM \"_sql_stat1\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: stat
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1 1']
  - ['T1', 'T1', '1 1']
  - ['T2', 'I1', '1 1']
  - ['T2', 'T2', '1 1']
...
-- Dropping an index.
box.sql.execute("DROP INDEX i1 ON t2;")
---
- rowcount: 3
...
-- Checking the DROP INDEX results.
box.sql.execute("SELECT * FROM \"_sql_stat4\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: neq
    type: UNKNOWN
  - name: nlt
    type: UNKNOWN
  - name: ndlt
    type: UNKNOWN
  - name: sample
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1', '0', '0', !!binary kQI=]
  - ['T1', 'T1', '1', '0', '0', !!binary kQE=]
  - ['T2', 'T2', '1', '0', '0', !!binary kQE=]
...
box.sql.execute("SELECT * FROM \"_sql_stat1\";")
---
- metadata:
  - name: tbl
    type: UNKNOWN
  - name: idx
    type: UNKNOWN
  - name: stat
    type: UNKNOWN
  rows:
  - ['T1', 'I1', '1 1']
  - ['T1', 'T1', '1 1']
  - ['T2', 'T2', '1 1']
...
--Cleaning up.
box.sql.execute("DROP TABLE t1;")
---
- rowcount: 5
...
box.sql.execute("DROP TABLE t2;")
---
- rowcount: 3
...
